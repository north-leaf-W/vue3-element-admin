system: 1.0.0
info:
  name: vue3-element-admin
  vars:
    ADMIN_SECRET:
      description: >-
        系统管理员密钥，用于访问控制和API认证
    AUTH_TOKEN:
      description: >-
        访问API所需的认证令牌
    DB_URL:
      description: >-
        数据库连接地址，如果使用外部数据库
envs:
  dev:
    branch: dev
  prod:
    branch: main
routes:
  main_env: prod
  main_app: frontend
auths:
  apikey:
    type: api_key
    envs:
      dev:
        in: header
        name: Authorization
        value: ${{vars.AUTH_TOKEN}}
      prod:
        in: header
        name: Authorization
        value: ${{vars.AUTH_TOKEN}}
apps:
  frontend:
    type: web_frontend
    envs:
      dev:
        build:
          root_path: .
          before_script: NODE_VERSION=20
          script: pnpm install --no-frozen-lockfile; pnpm build
        provision:
          root_path: dist
          type: nodejs18x
      prod:
        build:
          root_path: .
          before_script: NODE_VERSION=20
          script: pnpm install --no-frozen-lockfile; pnpm build
        provision:
          root_path: dist
          type: nodejs18x
  backend:
    type: web_api
    envs:
      dev:
        build:
          root_path: ./backend
          script: npm install
        provision:
          type: nodejs18x
          root_path: ./backend
          start_command: node server.js
          timeout: 120
          vars:
            - ADMIN_SECRET
            - AUTH_TOKEN
            - DB_URL
      prod:
        build:
          root_path: ./backend
          script: npm install
        provision:
          type: nodejs18x
          root_path: ./backend
          start_command: node server.js
          timeout: 120
          vars:
            - ADMIN_SECRET
            - AUTH_TOKEN
            - DB_URL
services:
  store:
    type: kv_store
    envs:
      dev:
        auths:
          - apikey
        provision:
          type: kv_store_v1
          namespaces:
            admin-cache: {} # 修改点
      prod:
        auths:
          - apikey
        provision:
          type: kv_store_v1
          namespaces:
            admin-cache: {}   # 修改点
            user-sessions: {} # 修改点
